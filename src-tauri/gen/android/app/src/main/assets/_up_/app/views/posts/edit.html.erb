<div class="container">
  <div class="page-header">
    <h1>✏️ Edit Post</h1>
    <p>Update your encrypted post content</p>
  </div>

  <div class="form-container">
    <%= form_with model: @post, class: "post-form" do |form| %>
      <% if @post.errors.any? %>
        <div class="error-messages">
          <h3><%= pluralize(@post.errors.count, "error") %> prohibited this post from being saved:</h3>
          <ul>
            <% @post.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <div class="form-group">
        <%= form.label :content, "Post Content", class: "form-label" %>
        <%= form.text_area :content, class: "form-control post-textarea", 
                            placeholder: "What's on your mind?",
                            rows: 6 %>
      </div>

      <% if @post.attachments.any? %>
        <div class="existing-attachments">
          <h3>📎 Current Attachments</h3>
          <p class="attachment-note">Note: File attachments cannot be modified after posting for security reasons.</p>
          
          <div class="attachment-list">
            <% @post.attachments.each do |attachment| %>
              <div class="attachment-item">
                <div class="attachment-icon">
                  <% case attachment.media_type %>
                  <% when 'image' %>
                    🖼️
                  <% when 'video' %>
                    🎥
                  <% when 'audio' %>
                    🎵
                  <% else %>
                    📄
                  <% end %>
                </div>
                <div class="attachment-info">
                  <strong><%= attachment.filename %></strong><br>
                  <small><%= attachment.human_file_size %> • <%= attachment.content_type %></small>
                </div>
                <div class="attachment-actions">
                  <%= link_to "View", post_attachment_path(@post, attachment), 
                              class: "btn btn-sm btn-outline", target: "_blank" %>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>

      <div class="encryption-info">
        <h3>🔐 Security Notice</h3>
        <ul>
          <li><strong>Content Updates:</strong> Text changes will be re-encrypted with your keys</li>
          <li><strong>File Attachments:</strong> Cannot be modified for security and integrity reasons</li>
          <li><strong>Signature:</strong> Post signature will be regenerated upon save</li>
        </ul>
      </div>

      <div class="form-actions">
        <%= form.submit "💾 Update Post", class: "btn btn-primary btn-large" %>
        <%= link_to "Cancel", @post, class: "btn btn-secondary" %>
        <%= link_to "Back to Posts", posts_path, class: "btn btn-outline" %>
      </div>
    <% end %>
  </div>
</div>

