<div class="container">
  <div class="welcome-hero">
    <h2>üîì Restore Your Identity</h2>
    <p>Sign in to your existing Cipher account</p>
  </div>

  <div class="form-container">
    <div class="form-section">
      <% if flash[:alert] %>
        <div class="error-messages">
          <p><%= flash[:alert] %></p>
        </div>
      <% end %>

      <%= form_tag '/api/v1/login', method: :post, id: "restore-form", class: "import-form" do %>
        <div class="restore-info">
          <h3>üîÑ Sign In to Your Cipher Account</h3>
          <p>Enter your username and master password to restore your identity.</p>
          
          <div class="info-note">
            <strong>üîë Zero-Knowledge Login:</strong>
            Your keys are recreated from your credentials - no files needed!
          </div>
        </div>

        <div class="form-group">
          <%= label_tag :username, "Username", class: "form-label" %>
          <%= text_field_tag :username, "", class: "form-control",
                             placeholder: "Enter your username",
                             required: true %>
          <small class="form-help">Your unique Cipher username</small>
        </div>

        <div class="form-group">
          <%= label_tag :password, "Master Password", class: "form-label" %>
          <%= password_field_tag :password, "", class: "form-control",
                                 placeholder: "Enter your master password",
                                 required: true %>
          <small class="form-help">The password you used when creating your account</small>
        </div>

        <div id="restore-progress" style="display: none;">
          <div class="restore-status">
            <p><strong>üîê Restoring Identity...</strong></p>
            <div class="progress-bar">
              <div id="restore-progress-bar" class="progress-fill"></div>
            </div>
            <p id="restore-status">Deriving keys from credentials...</p>
          </div>
        </div>

        <div class="form-actions">
          <%= submit_tag "üîì Restore & Sign In", class: "btn btn-primary btn-large" %>
        </div>
      <% end %>
    </div>

    <div class="info-section">
      <h3>How Identity Restoration Works</h3>
      <ol>
        <li><strong>Key Derivation:</strong> Your private key is recreated from username + password</li>
        <li><strong>Verification:</strong> The generated public key is checked against your account</li>
        <li><strong>Authentication:</strong> If keys match, you're logged in automatically</li>
        <li><strong>Local Storage:</strong> Your keys are stored encrypted in your browser</li>
      </ol>

      <div class="security-note">
        <h4>üõ°Ô∏è Zero-Knowledge Benefits</h4>
        <ul>
          <li><strong>No Files:</strong> No backup files to lose or manage</li>
          <li><strong>Portable:</strong> Access your identity from any Cipher instance</li>
          <li><strong>Secure:</strong> Private keys never leave your device</li>
          <li><strong>Deterministic:</strong> Same credentials always recreate the same identity</li>
        </ul>
      </div>

      <div class="help-section">
        <h4>‚ùì Troubleshooting</h4>
        <p>If restoration fails:</p>
        <ul>
          <li>Double-check your username spelling</li>
          <li>Verify your password is exactly as you created it</li>
          <li>Make sure your account exists on this Cipher instance</li>
          <li>Contact support if you're certain your credentials are correct</li>
        </ul>
      </div>
    </div>
  </div>
</div>

<style>
.restore-info {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(15px);
  padding: 20px;
  border-radius: 12px;
  margin-bottom: 20px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  position: relative;
  z-index: 1;
}

.restore-info h3 {
  margin-top: 0;
  color: white;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.info-note {
  background: rgba(102, 126, 234, 0.1);
  border: 1px solid rgba(102, 126, 234, 0.3);
  color: #667eea;
  padding: 15px;
  border-radius: 8px;
  margin-top: 15px;
  font-weight: 500;
}

.info-note strong {
  color: #4c51bf;
}

.restore-status {
  text-align: center;
  padding: 20px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  margin-top: 15px;
}

.progress-bar {
  width: 100%;
  height: 24px;
  background: #e0e0e0;
  border-radius: 12px;
  overflow: hidden;
  margin: 15px 0;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, #667eea, #764ba2);
  border-radius: 12px;
  transition: width 0.5s ease;
  width: 0%;
}

#restore-status {
  color: #2d3748;
  font-weight: 500;
  margin: 10px 0 0 0;
}

.security-note {
  background: rgba(231, 255, 231, 0.9);
  padding: 15px;
  border-radius: 8px;
  margin: 15px 0;
}

.security-note h4 {
  margin-top: 0;
  color: #155724;
}

.help-section {
  background: rgba(255, 247, 231, 0.9);
  padding: 15px;
  border-radius: 8px;
  margin-top: 15px;
}

.help-section h4 {
  margin-top: 0;
  color: #856404;
}

.info-section h4 {
  color: #2d3748;
  margin: 15px 0 8px 0;
  font-weight: 600;
}

.info-section ul, .info-section ol {
  color: #4a5568;
  margin-bottom: 15px;
}

.info-section code {
  background: rgba(0, 0, 0, 0.1);
  padding: 2px 6px;
  border-radius: 4px;
  font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
}
</style>

<!-- No JavaScript needed for local-only app with Rails forms -->