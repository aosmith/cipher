<% content_for :title, "Local Hosting - Cipher" %>

<div class="local-hosting-page">
  <div class="welcome-hero">
    <h2>ğŸ’¾ Hosting</h2>
    <p>Earn CPH tokens by sharing your device's storage space with the network</p>
    
    <!-- Tab Navigation -->
    <div class="tab-navigation">
      <button class="tab-button active" data-tab="local-hosting">ğŸ’¾ Local Hosting</button>
      <button class="tab-button" data-tab="host-dashboard">ğŸ“Š Host Dashboard</button>
    </div>
  </div>

  <!-- Hosting Status Overview -->
  <div class="card hosting-overview">
    <div class="card-header">
      <h2>Hosting Status</h2>
      <div class="hosting-toggle">
        <label class="toggle-switch">
          <input type="checkbox" id="hosting-toggle" checked />
          <span class="toggle-slider"></span>
        </label>
        <span id="hosting-status-text">ğŸŸ¢ Hosting Active</span>
      </div>
    </div>
    <div class="card-body">
      <div class="status-grid">
        <div class="status-item">
          <div class="status-icon">ğŸ’¾</div>
          <div class="status-info">
            <div class="status-label">Storage Allocated</div>
            <div id="storage-allocated" class="status-value">0 MB</div>
          </div>
        </div>
        
        <div class="status-item">
          <div class="status-icon">ğŸ“Š</div>
          <div class="status-info">
            <div class="status-label">Storage Used</div>
            <div id="storage-used" class="status-value">0 MB</div>
          </div>
        </div>
        
        <div class="status-item">
          <div class="status-icon">ğŸ“</div>
          <div class="status-info">
            <div class="status-label">Files Hosted</div>
            <div id="files-hosted" class="status-value">0</div>
          </div>
        </div>
        
        <div class="status-item">
          <div class="status-icon">ğŸ’°</div>
          <div class="status-info">
            <div class="status-label">Total Earned</div>
            <div id="total-earned" class="status-value">0 CPH</div>
          </div>
        </div>

        <div class="status-item">
          <div class="status-icon">ğŸŒ</div>
          <div class="status-info">
            <div class="status-label">P2P Network</div>
            <%= turbo_frame_tag "p2p-status" do %>
              <div id="p2p-status" class="status-value <%= p2p_status_css_class %>"><%= p2p_connection_status %></div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Storage Quota Configuration -->
  <div class="card quota-config">
    <div class="card-header">
      <h2>Storage Quota</h2>
    </div>
    <div class="card-body">
      <div class="quota-section">
        <div class="quota-controls">
          <div class="form-group">
            <label for="quota-slider">Allocate Storage Space:</label>
            <div class="quota-input-group">
              <input type="range" id="quota-slider" min="100" max="10000" step="100" value="500" class="quota-range">
              <div class="quota-value-container">
                <input type="number" id="quota-input" min="100" max="10000" value="500" class="quota-number">
                <span class="quota-unit">MB</span>
              </div>
            </div>
            <small class="form-help">Minimum: 100MB â€¢ Maximum: <span id="max-available">0</span>MB available</small>
          </div>
          
          <div class="quota-preview">
            <div class="quota-bar">
              <div class="quota-bar-used" id="quota-bar-used" style="width: 0%"></div>
              <div class="quota-bar-allocated" id="quota-bar-allocated" style="width: 20%"></div>
            </div>
            <div class="quota-labels">
              <span class="quota-label-used">Used: <span id="quota-used-mb">0</span>MB</span>
              <span class="quota-label-available">Available: <span id="quota-available-mb">500</span>MB</span>
            </div>
          </div>
          
          <button id="apply-quota-btn" class="btn btn-primary">Apply Storage Quota</button>
        </div>
        
        <div class="quota-info">
          <h3>How It Works</h3>
          <ul class="info-list">
            <li>ğŸ“ Files are stored encrypted in your browser's local storage</li>
            <li>ğŸ”’ You never have access to the actual file content</li>
            <li>ğŸ’° Earn CPH tokens based on storage provided and bandwidth served</li>
            <li>âš¡ Higher reliability and uptime = higher earnings multiplier</li>
            <li>ğŸ”„ Storage can be adjusted anytime (files may be redistributed)</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Earnings Dashboard -->
  <div class="card earnings-dashboard">
    <div class="card-header">
      <h2>Earnings Dashboard</h2>
    </div>
    <div class="card-body">
      <div class="earnings-grid">
        <div class="earnings-card">
          <div class="earnings-icon">ğŸ’</div>
          <div class="earnings-info">
            <div class="earnings-label">Storage Rewards</div>
            <div id="storage-rewards" class="earnings-value">0 CPH</div>
            <div class="earnings-rate">0.001 CPH/KB/day</div>
          </div>
        </div>
        
        <div class="earnings-card">
          <div class="earnings-icon">âš¡</div>
          <div class="earnings-info">
            <div class="earnings-label">Bandwidth Rewards</div>
            <div id="bandwidth-rewards" class="earnings-value">0 CPH</div>
            <div class="earnings-rate">0.8 CPH/KB served</div>
          </div>
        </div>
        
        <div class="earnings-card">
          <div class="earnings-icon">ğŸ¯</div>
          <div class="earnings-info">
            <div class="earnings-label">Reliability Bonus</div>
            <div id="reliability-bonus" class="earnings-value">100%</div>
            <div class="earnings-rate">Based on uptime</div>
          </div>
        </div>
        
        <div class="earnings-card">
          <div class="earnings-icon">ğŸ†</div>
          <div class="earnings-info">
            <div class="earnings-label">Pending Payout</div>
            <div id="pending-payout" class="earnings-value">0 CPH</div>
            <div class="earnings-actions">
              <button id="claim-earnings-btn" class="btn btn-sm btn-success" disabled>Claim</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Test Section (for development) -->
  <div class="card">
    <div class="card-header">
      <h2>ğŸ§ª Test Local Hosting</h2>
    </div>
    <div class="card-body">
      <div class="test-actions">
        <button id="test-store-file" class="btn btn-primary">Test Store File</button>
        <button id="test-retrieve-file" class="btn btn-secondary">Test Retrieve File</button>
        <button id="clear-storage" class="btn btn-outline">Clear All Storage</button>
      </div>
      <div id="test-results" class="test-results">
        <!-- Test results will appear here -->
      </div>
    </div>
  </div>

  <!-- Performance Metrics -->
  <div class="card performance-metrics">
    <div class="card-header">
      <h2>Performance Metrics</h2>
    </div>
    <div class="card-body">
      <div class="metrics-grid">
        <div class="metric-item">
          <div class="metric-label">Uptime</div>
          <div id="uptime-metric" class="metric-value">0 hours</div>
          <div class="metric-bar">
            <div class="metric-fill" id="uptime-fill" style="width: 0%"></div>
          </div>
        </div>
        
        <div class="metric-item">
          <div class="metric-label">Reliability Score</div>
          <div id="reliability-metric" class="metric-value">100%</div>
          <div class="metric-bar">
            <div class="metric-fill" id="reliability-fill" style="width: 100%"></div>
          </div>
        </div>
        
        <div class="metric-item">
          <div class="metric-label">Files Served</div>
          <div id="files-served-metric" class="metric-value">0</div>
        </div>
        
        <div class="metric-item">
          <div class="metric-label">Data Served</div>
          <div id="data-served-metric" class="metric-value">0 MB</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Activity -->
  <div class="card recent-activity">
    <div class="card-header">
      <h2>Recent Activity</h2>
    </div>
    <div class="card-body">
      <div id="activity-list" class="activity-list">
        <div class="no-activity">
          <div class="no-activity-icon">ğŸ“­</div>
          <p>No hosting activity yet</p>
          <small>Start hosting to see file storage and serving events here</small>
        </div>
      </div>
    </div>
  </div>
</div>


