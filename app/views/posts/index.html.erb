<div class="container">
  <div class="page-header">
    <h1>üìù My Posts</h1>
    <p>Your encrypted posts and media</p>
    <%= link_to "Create New Post", new_post_path, class: "btn btn-primary" %>
  </div>

  <% if @posts.any? %>
    <div class="posts-grid">
      <% @posts.each do |post| %>
        <div class="post-card">
          <div class="post-header">
            <div class="post-author">
              <strong><%= post.user.display_name || post.user.username %></strong>
            </div>
            <div class="post-timestamp">
              <%= post.timestamp&.strftime("%b %d, %Y at %I:%M %p") %>
            </div>
            <div class="post-actions">
              <%= link_to "‚úèÔ∏è", edit_post_path(post), class: "btn btn-sm btn-outline", title: "Edit post" %>
              <%= link_to "üóëÔ∏è", post_path(post), 
                  class: "btn btn-sm btn-danger", 
                  title: "Delete post",
                  data: { 
                    confirm: "Are you sure you want to delete this post? This action cannot be undone.",
                    turbo_method: :delete
                  } %>
            </div>
          </div>

          <% if post.content.present? %>
            <div class="post-content">
              <%= simple_format(post.content) %>
            </div>
          <% end %>

          <% if post.attachments.any? %>
            <div class="post-attachments">
              <% post.attachments.each do |attachment| %>
                <div class="attachment-item <%= attachment.media_type %>">
                  <% if attachment.is_image? %>
                    <div class="image-attachment">
                      <div data-controller="image-decryption"
                           data-image-decryption-attachment-url-value="<%= post_attachment_path(post, attachment) %>"
                           data-image-decryption-filename-value="<%= attachment.filename %>"
                           data-image-decryption-filesize-value="<%= attachment.human_file_size %>"
                           data-image-decryption-content-type-value="<%= attachment.content_type %>">
                        <div class="loading-placeholder">
                          <span class="loading-icon">üîì</span>
                          <span class="loading-text">Decrypting image...</span>
                          <small><%= attachment.filename %> (<%= attachment.human_file_size %>)</small>
                        </div>
                        <div class="image-overlay" style="display: none;">
                          <span class="image-filename"><%= attachment.filename %></span>
                          <span class="image-size"><%= attachment.human_file_size %></span>
                        </div>
                      </div>
                    </div>
                  <% elsif attachment.is_video? %>
                    <div class="video-attachment">
                      <%= link_to post_attachment_path(post, attachment), 
                                  class: "attachment-link", 
                                  target: "_blank" do %>
                        <div class="video-placeholder">
                          <div class="video-icon">üé•</div>
                          <div class="video-info">
                            <strong><%= attachment.filename %></strong><br>
                            <small><%= attachment.human_file_size %></small>
                          </div>
                        </div>
                      <% end %>
                    </div>
                  <% elsif attachment.is_audio? %>
                    <div class="audio-attachment">
                      <%= link_to post_attachment_path(post, attachment), 
                                  class: "attachment-link", 
                                  target: "_blank" do %>
                        <div class="audio-placeholder">
                          <div class="audio-icon">üéµ</div>
                          <div class="audio-info">
                            <strong><%= attachment.filename %></strong><br>
                            <small><%= attachment.human_file_size %></small>
                          </div>
                        </div>
                      <% end %>
                    </div>
                  <% else %>
                    <div class="file-attachment">
                      <%= link_to post_attachment_path(post, attachment), 
                                  class: "attachment-link", 
                                  target: "_blank" do %>
                        <div class="file-placeholder">
                          <div class="file-icon">üìÑ</div>
                          <div class="file-info">
                            <strong><%= attachment.filename %></strong><br>
                            <small><%= attachment.human_file_size %></small>
                          </div>
                        </div>
                      <% end %>
                    </div>
                  <% end %>
                </div>
              <% end %>
            </div>
          <% end %>

          <div class="post-footer">
            <div class="post-stats">
              <span class="attachment-count">
                <% if post.attachments.any? %>
                  üìé <%= pluralize(post.attachments.count, 'file') %>
                <% end %>
              </span>
            </div>
            <div class="encryption-badge">
              üîê Encrypted
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="empty-state">
      <div class="empty-icon">üìù</div>
      <h2>No posts yet</h2>
      <p>Create your first encrypted post to get started!</p>
      <%= link_to "Create Your First Post", new_post_path, class: "btn btn-primary btn-large" %>
    </div>
  <% end %>
</div>

