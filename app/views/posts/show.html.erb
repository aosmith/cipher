<% content_for :title, "Post" %>

<div class="container">
  <div class="post-viewer">
    <div class="message-item post" data-post-id="<%= @post.id %>" data-has-media="<%= @post.has_media? %>">
      <div class="message-header">
        <div class="author">
          <%= @post.user.display_name || @post.user.username %> (@<%= @post.user.username %>)
        </div>
        <div class="timestamp" data-timestamp="<%= @post.timestamp&.iso8601 %>">
          <%= time_ago_in_words(@post.timestamp) if @post.timestamp %> ago • 🔒 Encrypted
        </div>
        <div class="message-actions">
          <%= link_to "✏️", edit_post_path(@post), class: "btn btn-sm btn-outline", title: "Edit post" %>
          <%= button_to "Delete", post_path(@post), 
              method: :delete,
              class: "btn btn-sm btn-danger", 
              title: "Delete post",
              form_class: "delete-form",
              data: { 
                confirm: "Are you sure you want to delete this post? This action cannot be undone."
              } %>
        </div>
      </div>

      <div class="message-content">
        <% if @post.content.present? %>
          <%= simple_format(@post.content) %>
        <% end %>
        
        <% if @post.attachments.any? %>
          <div class="attachments-section">
            <% @post.attachments.each do |attachment| %>
              <div class="attachment-item">
                <% if attachment.content_type&.start_with?('image/') %>
                  🖼️
                <% elsif attachment.content_type&.start_with?('video/') %>
                  🎥
                <% elsif attachment.content_type&.start_with?('audio/') %>
                  🎵
                <% else %>
                  📎
                <% end %>
                <%= link_to attachment.filename, post_attachment_path(@post, attachment), target: "_blank", class: "attachment-link" %>
                (<%= number_to_human_size(attachment.file_size) %>)
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
    
    <div class="back-navigation">
      <%= link_to "← Back to Posts", posts_path, class: "btn btn-secondary" %>
    </div>
  </div>
</div>